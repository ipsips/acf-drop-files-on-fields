{"version":3,"sources":["acf-drop-files-on-fields.es6"],"names":["$","jQuery","ACFDropFilesOnFields","enabledTypes","options","init","selector","map","type","join","$fields","length","disableEditorAsDropTarget","each","addUploader","idx","field","_this","fieldType","data","uploader","wp","media","view","EditorUploader","extend","className","initialize","initialized","window","tinyMCEPreInit","dragDropUpload","browserSupport","dropzones","files","on","drop","bind","dropzoneDragover","dropzoneDragleave","click","__this","document","containerDragover","containerDragleave","evt","localDrag","render","View","prototype","apply","arguments","attach","isDescendant","originalEvent","dataTransfer","acf","fields","_show_field","target","closest","addMethodName","find","hasOwnProperty","methodName","workflow","state","reset","frames","ready","addFiles","refresh","dropzone_id","toggle","overContainer","overDropzone","toggleClass","draggingFile","uploaders","parent","node","parentNode","isReady","setTimeout","off","acfDropFilesOnFields","$code","html","pattern","match","replace","RegExp","trim","height","outerHeight","$btn","switchLabel","text"],"mappings":"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","file":"acf-drop-files-on-fields.js","sourcesContent":["const $ = jQuery\n\nclass ACFDropFilesOnFields {\n  constructor(enabledTypes, options) {\n    this.enabledTypes = enabledTypes\n    this.options = Object.assign({\n      disableEditorAsDropTarget: false\n    }, options)\n    this.uploaders = []\n\n    if ($.isReady)\n      setTimeout(this.init)\n    else\n      $(document).ready(() => setTimeout(this.init))\n  }\n  init = () => {\n    const selector = this.enabledTypes\n      .map(type => `.acf-field-${type}`)\n      .join(', ')\n    const $fields = $(selector)\n\n    if ($fields.length) {\n      if (!!this.options.disableEditorAsDropTarget)\n        this.disableEditorAsDropTarget()\n\n      $fields.each(this.addUploader)\n    }\n  }\n  addUploader = (idx, field) => {\n    const _this = this\n    const fieldType = $(field).data('type')\n    const uploader = wp.media.view.EditorUploader.extend({\n      className: 'uploader-acf-field',\n      initialize: function() {\n        this.initialized =\n          window.tinyMCEPreInit &&\n          window.tinyMCEPreInit.dragDropUpload &&\n          this.browserSupport()\n\n        if (this.initialized) {\n          this.dropzones = []\n          this.files = []\n\n          $(field)\n            .on('drop', '.uploader-acf-field', this.drop.bind(this))\n            .on('dragover', '.uploader-acf-field', this.dropzoneDragover.bind(this))\n            .on('dragleave', '.uploader-acf-field', this.dropzoneDragleave.bind(this))\n            .on('click', '.uploader-acf-field', this.click.bind(this))\n\n          const __this = this\n\n          $(document)\n            .on('dragover', this.containerDragover.bind(this))\n            .on('dragleave', this.containerDragleave.bind(this))\n            .on('dragstart dragend drop', (evt) => {\n              __this.localDrag = evt.type === 'dragstart'\n\n              if (evt.type === 'drop')\n                __this.containerDragleave()\n            })\n        }\n\n        return this\n      },\n      render: function() {\n        if (!this.initialized)\n          return this\n\n        wp.media.View.prototype.render.apply(this, arguments)\n        \n        this.attach(0, field)\n        \n        return this\n      },\n      drop: function(evt) {\n        this.containerDragleave(evt)\n        this.dropzoneDragleave(evt)\n\n        if (!_this.isDescendant(evt, field))\n          return\n\n        this.files = evt.originalEvent.dataTransfer.files\n        \n        if (this.files.length < 1)\n          return\n\n        acf.fields._show_field($(evt.target).closest('.acf-field'))\n\n        const addMethodName = ['add', '_add'].find(methodName =>\n          acf.fields[fieldType].hasOwnProperty(methodName)\n        )\n\n        if (addMethodName) {\n          acf.fields[fieldType][addMethodName]()\n\n          if (this.workflow)\n            this.workflow.state().reset()\n\n          this.workflow = acf.media.frames[0]\n          \n          if (this.workflow.uploader.uploader && this.workflow.uploader.uploader.ready)\n            this.addFiles.apply(this)\n          else\n            this.workflow.on('uploader:ready', this.addFiles, this)\n        }\n\n        return false\n      },\n      refresh: function(evt) {\n        let dropzone_id\n        \n        for (dropzone_id in this.dropzones)\n          this.dropzones[dropzone_id].toggle(this.overContainer || this.overDropzone)\n\n        if (typeof evt !== 'undefined')\n          $(evt.target)\n            .closest('.uploader-acf-field')\n            .toggleClass('droppable', this.overDropzone)\n\n        if (!this.overContainer && !this.overDropzone)\n          this.draggingFile = null\n\n        return this\n      }\n    })\n\n    this.uploaders[idx] = new uploader()\n    this.uploaders[idx].render()\n  }\n  isDescendant = (evt, parent) => {\n    let node = evt.target\n    \n    while (node !== null) {\n      if (node === parent)\n        return true\n      \n      node = node.parentNode\n    }\n\n    return false\n  }\n  disableEditorAsDropTarget() {\n    if ($('.wp-editor-wrap').length) {\n      $(document).off('drop', '.uploader-editor')\n      $(document).off('dragover', '.uploader-editor')\n      $(document).off('dragleave', '.uploader-editor')\n      $(document).off('click', '.uploader-editor')\n      $(document).off('dragover')\n      $(document).off('dragleave')\n      $(document).off('dragstart dragend drop')\n    }\n  }\n}\n\nif (window.hasOwnProperty('acfDropFilesOnFields'))\n  (({ enabledTypes, disableEditorAsDropTarget }) =>\n    new ACFDropFilesOnFields(\n      enabledTypes, {\n        disableEditorAsDropTarget\n      })\n  )(window.acfDropFilesOnFields)\n\n/**\n * Options screen functionality\n */\n$(document).ready(() => {\n  if (!$('#acf-drop-files-on-fields').length)\n    return\n\n  $('pre code').each(function () {\n    const $code = $(this)\n    \n    /**\n     * Remove leading white-space from the code block.\n     * @source http://stackoverflow.com/a/31754939/1364424\n     */\n    const html = $code.html()\n    const pattern = html.match(/\\s*\\n[\\t\\s]*/)\n\n    $code.html(html.replace(new RegExp(pattern, 'g'), '\\n').trim())\n\n    /* set height for proper exapand/collapse toggling */\n    $code.parent().height($code.outerHeight())\n  })\n\n  $('.code-block .expand-btn').on('click', function () {\n    const $btn = $(this)\n    const { switchLabel } = $(this).data()\n\n    $btn\n      .data('switch-label', $btn.text())\n      .text(switchLabel)\n      .parent()\n        .toggleClass('expanded')\n  })\n})"]}