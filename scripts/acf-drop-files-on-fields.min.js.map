{"version":3,"sources":["acf-drop-files-on-fields.es6"],"names":["$","jQuery","ACFDropFilesOnFields","enabledTypes","options","init","selector","map","type","join","$fields","length","disableEditorAsDropTarget","each","addUploader","idx","field","_this","fieldType","data","uploader","wp","media","view","EditorUploader","extend","className","initialize","initialized","window","tinyMCEPreInit","dragDropUpload","browserSupport","dropzones","files","on","drop","bind","dropzoneDragover","dropzoneDragleave","click","__this","document","containerDragover","containerDragleave","evt","localDrag","render","View","prototype","apply","arguments","attach","isDescendant","originalEvent","dataTransfer","acf","fields","_show_field","target","closest","addMethodName","find","hasOwnProperty","methodName","workflow","state","reset","frames","ready","addFiles","refresh","dropzone_id","toggle","overContainer","overDropzone","toggleClass","draggingFile","uploaders","parent","node","parentNode","isReady","setTimeout","off","acfDropFilesOnFields","$code","html","pattern","match","replace","RegExp","trim","height","outerHeight","$btn","switchLabel","text"],"mappings":"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","file":"acf-drop-files-on-fields.min.js","sourcesContent":["const $ = jQuery\n\nclass ACFDropFilesOnFields {\n  constructor(enabledTypes, options) {\n    this.enabledTypes = enabledTypes\n    this.options = Object.assign({\n      disableEditorAsDropTarget: false\n    }, options)\n    this.uploaders = []\n\n    if ($.isReady)\n      setTimeout(this.init)\n    else\n      $(document).ready(() => setTimeout(this.init))\n  }\n  init = () => {\n    const selector = this.enabledTypes\n      .map(type => `.acf-field-${type}`)\n      .join(', ')\n    const $fields = $(selector)\n\n    if ($fields.length) {\n      if (!!this.options.disableEditorAsDropTarget)\n        this.disableEditorAsDropTarget()\n\n      $fields.each(this.addUploader)\n    }\n  }\n  addUploader = (idx, field) => {\n    const _this = this\n    const fieldType = $(field).data('type')\n    const uploader = wp.media.view.EditorUploader.extend({\n      className: 'uploader-acf-field',\n      initialize: function() {\n        this.initialized =\n          window.tinyMCEPreInit &&\n          window.tinyMCEPreInit.dragDropUpload &&\n          this.browserSupport()\n\n        if (this.initialized) {\n          this.dropzones = []\n          this.files = []\n\n          $(field)\n            .on('drop', '.uploader-acf-field', this.drop.bind(this))\n            .on('dragover', '.uploader-acf-field', this.dropzoneDragover.bind(this))\n            .on('dragleave', '.uploader-acf-field', this.dropzoneDragleave.bind(this))\n            .on('click', '.uploader-acf-field', this.click.bind(this))\n\n          const __this = this\n\n          $(document)\n            .on('dragover', this.containerDragover.bind(this))\n            .on('dragleave', this.containerDragleave.bind(this))\n            .on('dragstart dragend drop', (evt) => {\n              __this.localDrag = evt.type === 'dragstart'\n\n              if (evt.type === 'drop')\n                __this.containerDragleave()\n            })\n        }\n\n        return this\n      },\n      render: function() {\n        if (!this.initialized)\n          return this\n\n        wp.media.View.prototype.render.apply(this, arguments)\n        \n        this.attach(0, field)\n        \n        return this\n      },\n      drop: function(evt) {\n        this.containerDragleave(evt)\n        this.dropzoneDragleave(evt)\n\n        if (!_this.isDescendant(evt, field))\n          return\n\n        this.files = evt.originalEvent.dataTransfer.files\n        \n        if (this.files.length < 1)\n          return\n\n        acf.fields._show_field($(evt.target).closest('.acf-field'))\n\n        const addMethodName = ['add', '_add'].find(methodName =>\n          acf.fields[fieldType].hasOwnProperty(methodName)\n        )\n\n        if (addMethodName) {\n          acf.fields[fieldType][addMethodName]()\n\n          if (this.workflow)\n            this.workflow.state().reset()\n\n          this.workflow = acf.media.frames[0]\n          \n          if (this.workflow.uploader.uploader && this.workflow.uploader.uploader.ready)\n            this.addFiles.apply(this)\n          else\n            this.workflow.on('uploader:ready', this.addFiles, this)\n        }\n\n        return false\n      },\n      refresh: function(evt) {\n        let dropzone_id\n        \n        for (dropzone_id in this.dropzones)\n          this.dropzones[dropzone_id].toggle(this.overContainer || this.overDropzone)\n\n        if (typeof evt !== 'undefined')\n          $(evt.target)\n            .closest('.uploader-acf-field')\n            .toggleClass('droppable', this.overDropzone)\n\n        if (!this.overContainer && !this.overDropzone)\n          this.draggingFile = null\n\n        return this\n      }\n    })\n\n    this.uploaders[idx] = new uploader()\n    this.uploaders[idx].render()\n  }\n  isDescendant = (evt, parent) => {\n    let node = evt.target\n    \n    while (node !== null) {\n      if (node === parent)\n        return true\n      \n      node = node.parentNode\n    }\n\n    return false\n  }\n  disableEditorAsDropTarget() {\n    if ($('.wp-editor-wrap').length) {\n      $(document).off('drop', '.uploader-editor')\n      $(document).off('dragover', '.uploader-editor')\n      $(document).off('dragleave', '.uploader-editor')\n      $(document).off('click', '.uploader-editor')\n      $(document).off('dragover')\n      $(document).off('dragleave')\n      $(document).off('dragstart dragend drop')\n    }\n  }\n}\n\nif (window.hasOwnProperty('acfDropFilesOnFields'))\n  (({ enabledTypes, disableEditorAsDropTarget }) =>\n    new ACFDropFilesOnFields(\n      enabledTypes, {\n        disableEditorAsDropTarget\n      })\n  )(window.acfDropFilesOnFields)\n\n/**\n * Options screen functionality\n */\n$(document).ready(() => {\n  if (!$('#acf-drop-files-on-fields').length)\n    return\n\n  $('pre code').each(function () {\n    const $code = $(this)\n    \n    /**\n     * Remove leading white-space from the code block.\n     * @source http://stackoverflow.com/a/31754939/1364424\n     */\n    const html = $code.html()\n    const pattern = html.match(/\\s*\\n[\\t\\s]*/)\n\n    $code.html(html.replace(new RegExp(pattern, 'g'), '\\n').trim())\n\n    /* set height for proper exapand/collapse toggling */\n    $code.parent().height($code.outerHeight())\n  })\n\n  $('.code-block .expand-btn').on('click', function () {\n    const $btn = $(this)\n    const { switchLabel } = $(this).data()\n\n    $btn\n      .data('switch-label', $btn.text())\n      .text(switchLabel)\n      .parent()\n        .toggleClass('expanded')\n  })\n})"]}